pipeline{
    agent any
    tools {
        maven 'maven'
    }
    
    stages{
        stage("Source Control -Git Checkout"){
            steps{
                git url: 'https://github.com/amaitisears/WebApp.git'
            }
        }

         stage("Compile - Maven") {
            agent any
            steps {
               sh 'mvn clean install'
               
            }
        }   
        
        stage("Deploy to QA - tomcat"){
            steps{
                sh 'mvn clean package'
                deploy adapters: [tomcat7(credentialsId: 'tomcat', path: '', url: 'http://18.218.122.189:8080/')], contextPath: '/QAWebapp', onFailure: false, war: '**/*.war'
            }
        }
        
        stage("Functional Test - Quality - Selenium"){
            steps{
                sh 'mvn clean package -f functionaltest/pom.xml'
                publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false, reportDir: '\\functionaltest\\target\\surefire-reports', reportFiles: 'index.html', reportName: 'HTML Report', reportTitles: ''])
            }
        }
        
        stage("Performance Test - Quality - Blazemeter"){
            steps{
                blazeMeterTest credentialsId: 'Blazemeter', testId: '7892218.taurus', workspaceId: '475066'      
                // blazeMeterTest credentialsId: 'Blazemeter', testId: '7913784.taurus', workspaceId: '480055'     
            }
        }
        
        stage("Deploy to Prod - tomcat"){
            steps{
                sh 'mvn clean package'
                deploy adapters: [tomcat7(credentialsId: 'tomcat', path: '', url: 'http://3.134.101.93:8080/')], contextPath: '/QAWebapp', onFailure: false, war: '**/*.war'
            }
        }
        
        stage("Sanity Test - Quality - Selenium"){
            steps{
                sh 'mvn clean package -f Acceptancetest/pom.xml'
                publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false, reportDir: '\\Acceptancetest\\target\\surefire-reports', reportFiles: 'index.html', reportName: 'HTML Report', reportTitles: ''])               
            }
        }
    }
}
